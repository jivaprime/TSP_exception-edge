# Exception-Edge Theory Guided PPO TSP Solver
# Experiment Log: d1291 (PPO-only, excluding ILS)
# ============================================================

## Configuration
- Instance: d1291 (n=1291)
- Version: v4.1
- GPU: A100 (Google Colab)
- Total Time: 30,000s (PPO phase: 20,000s)
- Seed: (default)

## Theory Parameters
- Mass Threshold (c·log n): 10.74
- Base Core Ratio (n^-1/3): 0.1837
- Max Active Nodes: 474
- η: 0.1884
- ρ_hi: 1.1884

## Preprocessing
- Density Map: 2 islands, 342 sea nodes
- Thickness Score: 221.13 (λ₂=0.0045)

## Initial Solution
- Nearest Neighbor: 64,446.53
- After 2-opt: 61,378.72

## PPO Main Loop Progress

| Time (s) | Iteration | Best Length | Mode | Improvement |
|----------|-----------|-------------|------|-------------|
| 0.1 | 0 | 60,905.28 | EXPLORE | -0.77% |
| 0.6 | 1 | 60,617.39 | EXPLORE | -0.47% |
| 1.0 | 2 | 60,241.51 | EXPLORE | -0.62% |
| 1.4 | 3 | 60,031.58 | EXPLORE | -0.35% |
| 1.7 | 4 | 59,935.20 | EXPLORE | -0.16% |
| 2.1 | 5 | 59,597.02 | EXPLORE | -0.56% |
| 2.4 | 6 | 59,136.94 | EXPLORE | -0.77% |
| 2.8 | 7 | 58,855.79 | EXPLORE | -0.48% |
| 3.1 | 8 | 58,418.89 | EXPLORE | -0.74% |
| 3.4 | 9 | 57,876.13 | EXPLORE | -0.93% |
| 3.8 | 10 | 57,422.02 | EXPLORE | -0.78% |
| 4.1 | 11 | 57,078.54 | EXPLORE | -0.60% |
| 4.5 | 12 | 56,867.83 | EXPLORE | -0.37% |
| 4.8 | 13 | 56,692.22 | EXPLORE | -0.31% |
| 5.2 | 14 | 56,677.80 | EXPLORE | -0.03% |
| 7.2 | 20 | 56,661.79 | EXPLORE | -0.03% |
| 9.9 | 28 | 56,578.28 | EXPLORE | -0.15% |
| 11.6 | 33 | 56,520.70 | EXPLORE | -0.10% |
| 26.6 | 78 | 56,512.54 | ESCAPE | -0.01% |
| 28.6 | 84 | 56,497.89 | ESCAPE | -0.03% |
| 31.2 | 92 | 56,478.80 | ESCAPE | -0.03% |
| 32.9 | 97 | 56,469.89 | ESCAPE | -0.02% |
| 45.1 | 132 | 56,468.41 | MACRO_FOCUS | -0.00% |
| 66.2 | 195 | 56,421.24 | STANDARD | -0.08% |
| 67.2 | 198 | 56,379.11 | STANDARD | -0.07% |
| 178.7 | 523 | 56,311.25 | FINALIZE | -0.12% |
| 185.5 | 543 | 56,260.45 | FINALIZE | -0.09% |
| 191.2 | 560 | 56,201.66 | ESCAPE | -0.10% |
| 197.9 | 580 | 56,193.32 | ESCAPE | -0.01% |
| 199.2 | 584 | 56,178.68 | ESCAPE | -0.03% |
| 200.2 | 587 | 56,167.37 | ESCAPE | -0.02% |
| 201.2 | 590 | 56,151.11 | ESCAPE | -0.03% |
| 210.1 | 615 | 56,143.13 | FINALIZE | -0.01% |
| 224.9 | 659 | 56,123.57 | MACRO_FOCUS | -0.03% |
| 248.2 | 726 | 56,109.83 | EXPLORE | -0.02% |
| 308.0 | 901 | 55,739.78 | MACRO_FOCUS | -0.66% |
| 308.3 | 902 | 55,539.01 | MACRO_FOCUS | -0.36% |
| 308.7 | 903 | 55,286.58 | MACRO_FOCUS | -0.45% |
| 309.0 | 904 | 55,257.29 | MACRO_FOCUS | -0.05% |
| 309.4 | 905 | 55,237.84 | MACRO_FOCUS | -0.04% |
| 310.4 | 908 | 55,040.34 | MACRO_FOCUS | -0.36% |
| 310.8 | 909 | 54,996.94 | MACRO_FOCUS | -0.08% |
| 314.8 | 921 | 54,962.14 | MACRO_FOCUS | -0.06% |
| 318.2 | 931 | 54,949.37 | MACRO_FOCUS | -0.02% |
| 324.0 | 948 | 54,924.02 | MACRO_FOCUS | -0.05% |
| 325.4 | 952 | 54,908.64 | EXPLORE | -0.03% |
| 326.0 | 954 | 54,872.22 | EXPLORE | -0.07% |
| 327.4 | 958 | 54,841.07 | EXPLORE | -0.06% |
| 355.7 | 1040 | 54,779.78 | FINALIZE | -0.11% |
| 357.7 | 1046 | 54,706.48 | FINALIZE | -0.13% |
| 366.5 | 1072 | 54,690.22 | STANDARD | -0.03% |
| 367.9 | 1076 | 54,639.42 | STANDARD | -0.09% |
| 371.2 | 1086 | 54,495.20 | STANDARD | -0.26% |
| 394.8 | 1154 | 54,478.22 | FINALIZE | -0.03% |
| 419.9 | 1227 | 54,434.72 | EXPLORE | -0.08% |
| 449.3 | 1313 | 54,239.09 | STANDARD | -0.36% |
| 532.8 | 1557 | 54,124.28 | FINALIZE | -0.21% |
| 747.0 | 2182 | 54,097.46 | MACRO_FOCUS | -0.05% |
| 752.1 | 2197 | 53,975.31 | MACRO_FOCUS | -0.23% |
| 764.8 | 2233 | 53,816.66 | MACRO_FOCUS | -0.29% |
| 1185.1 | 3454 | 53,771.78 | ESCAPE | -0.08% |
| 1326.3 | 3864 | 53,562.01 | ESCAPE | -0.39% |
| 1326.7 | 3865 | 53,526.65 | ESCAPE | -0.07% |
| 1335.8 | 3892 | 53,470.38 | ESCAPE | -0.11% |
| 1341.0 | 3906 | 53,440.30 | EXPLORE | -0.06% |
| 1349.1 | 3930 | 53,425.66 | EXPLORE | -0.03% |
| 1357.5 | 3955 | 53,409.40 | MACRO_FOCUS | -0.03% |
| 1361.2 | 3966 | 53,405.58 | MACRO_FOCUS | -0.01% |
| 1389.2 | 4047 | 53,390.94 | STANDARD | -0.03% |
| 1445.2 | 4210 | 53,288.34 | FINALIZE | -0.19% |
| 2307.3 | 6722 | 53,274.18 | MACRO_FOCUS | -0.03% |
| 2307.6 | 6723 | 53,266.78 | MACRO_FOCUS | -0.01% |
| 2363.8 | 6887 | 53,233.10 | STANDARD | -0.06% |
| 3010.2 | 8763 | 53,214.86 | STANDARD | -0.03% |
| 3010.5 | 8764 | 53,186.27 | STANDARD | -0.05% |
| 3012.2 | 8769 | 53,155.77 | STANDARD | -0.06% |
| 3027.1 | 8812 | 53,133.02 | ESCAPE | -0.04% |
| 3111.5 | 9058 | 53,101.35 | MACRO_FOCUS | -0.06% |
| 3117.2 | 9075 | 53,092.56 | MACRO_FOCUS | -0.02% |
| 3174.4 | 9241 | 53,005.73 | STANDARD | -0.16% |
| 3178.5 | 9253 | 52,862.46 | EXPLORE | -0.27% |
| 3253.4 | 9471 | 52,855.65 | ESCAPE | -0.01% |
| 3445.5 | 10028 | 52,731.70 | ESCAPE | -0.23% |
| 3557.9 | 10353 | 52,609.10 | MACRO_FOCUS | -0.23% |
| 4094.0 | 11898 | 52,587.56 | ESCAPE | -0.04% |
| 4565.7 | 13259 | 52,567.62 | ESCAPE | -0.04% |
| 4651.6 | 13505 | 52,503.41 | STANDARD | -0.12% |
| 5379.5 | 15614 | 52,424.60 | ESCAPE | -0.15% |
| 5604.0 | 16265 | 52,406.20 | ESCAPE | -0.04% |
| 6362.5 | 18455 | 52,364.69 | STANDARD | -0.08% |
| 6447.2 | 18700 | 52,322.60 | ESCAPE | -0.08% |
| 6644.1 | 19268 | 52,272.91 | FINALIZE | -0.10% |
| 7600.6 | 22023 | 52,130.74 | ESCAPE | -0.27% |
| 8611.5 | 24941 | 52,100.47 | STANDARD | -0.06% |
| 9202.9 | 26649 | 52,006.00 | FINALIZE | -0.18% |
| 10154.9 | 29406 | 52,005.23 | MACRO_FOCUS | -0.00% |
| 10546.1 | 30542 | 51,990.58 | ESCAPE | -0.03% |
| 10603.3 | 30708 | 51,970.09 | EXPLORE | -0.04% |
| 10687.6 | 30954 | 51,903.54 | ESCAPE | -0.13% |
| 10827.1 | 31360 | 51,900.18 | MACRO_FOCUS | -0.01% |
| 11008.0 | 31885 | 51,836.63 | FINALIZE | -0.12% |
| 11497.7 | 33305 | 51,820.09 | ESCAPE | -0.03% |
| 11681.3 | 33839 | 51,814.43 | FINALIZE | -0.01% |
| 15235.3 | 44130 | 51,688.69 | MACRO_FOCUS | -0.24% |
| 16882.7 | 48910 | 51,680.75 | STANDARD | -0.02% |
| 18167.7 | 52640 | 51,674.50 | ESCAPE | -0.01% |
| 18892.9 | 54747 | 51,646.49 | STANDARD | -0.05% |

## PPO-only Summary

| Metric | Value |
|--------|-------|
| **Final Best (PPO)** | **51,646.49** |
| Initial (NN) | 64,446.53 |
| After 2-opt | 61,378.72 |
| Total Improvement | 19.86% |
| PPO Iterations | 54,747 |
| PPO Time | ~20,000s |
| Best Known (observed) | 51,827 |
| **Gap vs Observed** | **-0.35%** |

## Mode Distribution (approximate)
- EXPLORE: Fast initial improvement
- ESCAPE: Breaking local optima  
- MACRO_FOCUS: Large jumps (e.g., 55,739 → 54,996 in 1s)
- FINALIZE: Refinement
- STANDARD: Balanced search

## Key Observations

1. **Rapid Initial Convergence**: 61,378 → 56,520 in first 12s (7.9% improvement)

2. **MACRO_FOCUS Breakthroughs**: 
   - At ~308s: 55,739 → 54,996 (1.3% jump in <1s)
   - Mode specifically designed for macro-bridge exploration

3. **Diminishing Returns Pattern**:
   - First 1,000 iterations: 61,378 → 54,495 (11.2%)
   - Next 10,000 iterations: 54,495 → 52,609 (3.5%)
   - Final 40,000+ iterations: 52,609 → 51,646 (1.8%)

4. **Theory-Guided Gating Effect**:
   - Exception edge detection focuses search
   - Length-gated mass condition (v4.1) reduces noise

## Reproducibility Notes

- Seed: Default (for exact reproduction, fix seed=42)
- Hardware: A100 GPU required for similar timing
- Dependencies: numpy, scipy, torch, numba
- Numba cache: Enable for consistent JIT compilation

## Files
- Code: tsp_solver.py (v4.1.0)
- Instance: d1291.tsp (TSPLIB)
- This log: d1291_ppo_log.txt
